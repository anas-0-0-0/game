<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ ŸÑÿπÿ®ÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™ - ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="styles-common.css" rel="stylesheet">
    <style>
        .container { max-width: 1400px; margin: 0 auto; padding: var(--spacing-mobile); }
        @media (min-width: 769px) { .container { padding: var(--spacing-tablet); } }
        .header { margin-bottom: 25px; }
        .header h1 { color: var(--navis-primary); font-size: 1.8em; margin: 0; }
        @media (max-width: 768px) { .header h1 { font-size: 1.4em; } }

        .top-bar {
            position: sticky;
            top: 0;
            z-index: 40;
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(0,0,0,0.22);
            border: 1px solid rgba(255,255,255,0.14);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(14px);
        }
        .top-bar-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            align-items: center;
        }
        .top-bar-main {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .pill {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.14);
            color: rgba(255,255,255,0.95);
            font-weight: 800;
        }
        .pill .value {
            background: linear-gradient(135deg, var(--navis-secondary), var(--navis-light-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .btn-compact { padding: 10px 14px; border-radius: 14px; }
        .progress-text {
            font-weight: 900;
            color: rgba(255,255,255,0.92);
            font-variant-numeric: tabular-nums;
        }

        .timer-ring {
            --p: 0;
            width: 56px;
            height: 56px;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background:
                conic-gradient(var(--science-red) calc(var(--p) * 1%), rgba(255,255,255,0.12) 0);
            border: 1px solid rgba(255,255,255,0.14);
        }
        .timer-ring-inner {
            width: 44px;
            height: 44px;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.28);
            font-weight: 900;
            color: rgba(255,255,255,0.95);
            font-variant-numeric: tabular-nums;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .room-code { font-size: 1.2em; color: var(--navis-primary); }
        .timer { font-size: 1.5em; font-weight: bold; color: var(--science-red); }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .teams-section {
            background: var(--card-bg);
            border-radius: var(--radius-md);
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .teams-section h2 {
            color: var(--navis-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .team-card {
            background: var(--card-bg-2);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .team-card.active {
            background: var(--card-bg);
            border-color: var(--navis-primary);
        }

        .team-card h3 { color: #fff; margin-bottom: 10px; }
        .team-score { font-size: 1.5em; font-weight: bold; color: var(--navis-primary); margin-bottom: 10px; }

        .team-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-bottom: 10px;
        }

        .team-status.answered {
            background: rgba(60, 179, 113, 0.2);
            color: var(--navis-secondary);
        }

        .team-status.waiting {
            background: rgba(255, 165, 0, 0.2);
            color: var(--navis-orange);
        }

        .question-section {
            background: var(--card-bg);
            border-radius: var(--radius-md);
            padding: 25px;
            border: 1px solid var(--border-color);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: var(--navis-primary);
            color: var(--bg-dark-1);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .question-category {
            background: var(--card-bg);
            color: var(--navis-primary);
            padding: 5px 15px;
            border-radius: 15px;
        }

        .question-text { font-size: 1.3em; margin-bottom: 30px; line-height: 1.5; color: #fff; }

        .question-card {
            background: rgba(0,0,0,0.16);
            border: 1px solid rgba(255,255,255,0.14);
            border-radius: var(--radius-md);
            padding: 18px;
            max-height: 180px;
            overflow: auto;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option {
            background: var(--card-bg-2);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 1.1em;
            color: #fff;
            min-height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option:hover {
            background: var(--card-bg);
            border-color: var(--navis-primary);
            transform: translateY(-2px);
        }

        .option.selected {
            background: var(--card-bg);
            border-color: var(--navis-primary);
        }

        .option.correct {
            background: rgba(60, 179, 113, 0.2);
            border-color: var(--navis-secondary);
        }

        .option.wrong {
            background: rgba(231, 76, 60, 0.2);
            border-color: var(--science-red);
        }

        .option.disabled { opacity: 0.5; cursor: not-allowed; }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--navis-primary), var(--navis-dark-blue));
            color: #fff;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--navis-secondary), var(--navis-dark-green));
            color: #fff;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--science-red), var(--science-red-dark));
            color: #fff;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-glow); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .feedback {
            background: rgba(0,0,0,0.18);
            border: 1px solid rgba(255,255,255,0.14);
            border-radius: var(--radius-md);
            padding: 14px;
            margin-top: 14px;
            display: grid;
            gap: 6px;
        }
        .feedback-title {
            font-weight: 900;
            color: rgba(255,255,255,0.95);
        }
        .feedback-line {
            color: rgba(255,255,255,0.85);
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .results-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--bg-dark-2), var(--bg-dark-1));
            border-radius: var(--radius-lg);
            padding: 30px;
            max-width: 600px;
            text-align: center;
            border: 2px solid var(--border-color);
        }

        .winner { font-size: 2em; color: var(--science-blue); margin-bottom: 20px; }
        .final-scores { margin: 20px 0; }
        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: var(--card-bg);
            border-radius: var(--radius-sm);
        }

        @media (max-width: 1024px) {
            .main-content { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .top-bar-row { grid-template-columns: 1fr; }
            .btn { width: 100%; justify-content: center; }
            .main-content { grid-template-columns: 1fr; }
            .options-container { grid-template-columns: 1fr; }
            .team-card { padding: 14px; }
            .question-section { padding: 18px; }
            .question-card { max-height: 220px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <div class="top-bar-row">
                <div class="top-bar-main">
                    <button class="btn btn-primary btn-compact" id="exit-btn" type="button" style="background: rgba(255, 255, 255, 0.1);">
                        <i class="fas fa-sign-out-alt"></i> ŸÖÿ∫ÿßÿØÿ±ÿ©
                    </button>
                    <div class="pill">
                        <span><i class="fas fa-users"></i></span>
                        <span id="team-name" class="value">‚Äî</span>
                    </div>
                    <div class="pill">
                        <span>ÿßŸÑŸÜŸÇÿßÿ∑</span>
                        <span class="value" id="score-display">0</span>
                    </div>
                    <div class="pill">
                        <span>ÿßŸÑÿ∫ÿ±ŸÅÿ©</span>
                        <span class="value" id="room-code-display">----</span>
                    </div>
                    <div class="pill">
                        <span>ÿßŸÑÿ™ŸÇÿØŸÖ</span>
                        <span class="progress-text" id="progress-display">1/1</span>
                    </div>
                </div>
                <div style="display:flex; align-items:center; gap:10px; justify-content:flex-end;">
                    <div class="timer-ring" id="timer-ring" style="--p: 100;">
                        <div class="timer-ring-inner"><span id="timer">30</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- ŸÇÿ≥ŸÖ ÿßŸÑŸÅÿ±ŸÇ -->
            <div class="teams-section">
                <h2><i class="fas fa-users"></i> ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ÿ©</h2>
                <div id="teams-container">
                    <!-- ÿ≥Ÿäÿ™ŸÖ ÿπÿ±ÿ∂ ÿßŸÑŸÅÿ±ŸÇ ŸáŸÜÿß -->
                </div>
            </div>

            <!-- ŸÇÿ≥ŸÖ ÿßŸÑÿ≥ÿ§ÿßŸÑ -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number" id="question-number">ÿßŸÑÿ≥ÿ§ÿßŸÑ 1</span>
                    <span class="question-category" id="question-category">ÿπŸÑŸàŸÖ</span>
                </div>
                <div class="question-text question-card" id="question-text">
                    ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≥ÿ§ÿßŸÑ...
                </div>
                <div class="options-container" id="options-container">
                    <!-- ÿ≥Ÿäÿ™ŸÖ ÿπÿ±ÿ∂ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ŸáŸÜÿß -->
                </div>

                <div class="feedback" id="feedback-panel" style="display:none;">
                    <div class="feedback-title" id="feedback-title">‚Äî</div>
                    <div class="feedback-line" id="feedback-line-1">‚Äî</div>
                    <div class="feedback-line" id="feedback-line-2">‚Äî</div>
                </div>

                <div class="game-controls">
                    <button class="btn btn-primary" id="next-question-btn" disabled>
                        <i class="fas fa-arrow-right"></i> ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ÿßŸÑŸä
                    </button>
                    <button class="btn btn-success" id="show-answer-btn" disabled>
                        <i class="fas fa-eye"></i> ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©
                    </button>
                    <button class="btn btn-danger" id="end-game-btn">
                        <i class="fas fa-stop"></i> ÿ•ŸÜŸáÿßÿ° ÿßŸÑŸÑÿπÿ®ÿ©
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÿ≠ÿßŸÑÿ© ÿßŸÑŸÑÿπÿ®ÿ©
        const gameState = {
            currentQuestion: 0,
            questions: [],
            teams: [],
            currentTeamAnswering: null,
            questionStartMs: 0,
            timer: 30,
            timerInterval: null,
            gameActive: false
        };

        // ÿπŸÜÿßÿµÿ± Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        const elements = {
            roomCodeDisplay: document.getElementById('room-code-display'),
            timer: document.getElementById('timer'),
            timerRing: document.getElementById('timer-ring'),
            questionNumber: document.getElementById('question-number'),
            questionCategory: document.getElementById('question-category'),
            questionText: document.getElementById('question-text'),
            optionsContainer: document.getElementById('options-container'),
            teamsContainer: document.getElementById('teams-container'),
            nextQuestionBtn: document.getElementById('next-question-btn'),
            showAnswerBtn: document.getElementById('show-answer-btn'),
            endGameBtn: document.getElementById('end-game-btn'),
            exitBtn: document.getElementById('exit-btn'),
            teamName: document.getElementById('team-name'),
            scoreDisplay: document.getElementById('score-display'),
            progressDisplay: document.getElementById('progress-display'),
            feedbackPanel: document.getElementById('feedback-panel'),
            feedbackTitle: document.getElementById('feedback-title'),
            feedbackLine1: document.getElementById('feedback-line-1'),
            feedbackLine2: document.getElementById('feedback-line-2')
        };

        function updateTopScore() {
            if (!elements.scoreDisplay) return;
            var score = 0;
            try {
                var teamData = JSON.parse(localStorage.getItem('currentTeam') || '{}');
                var currentId = teamData && (teamData.id !== undefined && teamData.id !== null) ? teamData.id : null;
                if (currentId !== null) {
                    var t = gameState.teams.find(function(x) { return x && String(x.id) === String(currentId); });
                    if (t) score = t.score || 0;
                } else if (gameState.currentTeamAnswering !== null) {
                    var t2 = gameState.teams.find(function(x) { return x && String(x.id) === String(gameState.currentTeamAnswering); });
                    if (t2) score = t2.score || 0;
                }
            } catch (e) {}
            elements.scoreDisplay.textContent = String(score);
        }

        // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÑÿπÿ®ÿ©
        function initGame() {
            // ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∫ÿ±ŸÅÿ©
            loadRoomData();

            try {
                const teamData = JSON.parse(localStorage.getItem('currentTeam') || '{}');
                if (elements.teamName) {
                    elements.teamName.textContent = teamData.teamName || teamData.name || '‚Äî';
                }
            } catch (e) {}

            if (elements.exitBtn) {
                elements.exitBtn.addEventListener('click', function() {
                    try {
                        window.location.href = 'student-waiting.html';
                    } catch (e) {
                        window.location.href = 'student.html';
                    }
                });
            }
            
            // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©
            loadQuestions();
            
            // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿ±ŸÇ
            loadTeams();
            
            // ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ£ŸàŸÑ
            displayQuestion();
            
            // ÿ®ÿØÿ° ÿßŸÑŸÑÿπÿ®ÿ©
            startGame();
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∫ÿ±ŸÅÿ©
        function loadRoomData() {
            const roomCode = localStorage.getItem('currentRoom');
            if (roomCode) {
                elements.roomCodeDisplay.textContent = roomCode;
            }
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©
        function loadQuestions() {
            const questionsData = localStorage.getItem('gameQuestions');
            if (questionsData) {
                gameState.questions = JSON.parse(questionsData);
            } else {
                // ÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
                gameState.questions = [
                    {
                        question: "ŸÖÿß ŸáŸà ÿßŸÑŸÖÿµÿ∑ŸÑÿ≠ ÿßŸÑÿπŸÑŸÖŸä ŸÑŸÑŸàÿ≠ÿØÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸÑŸÑÿ≠Ÿäÿßÿ©ÿü",
                        options: ["ÿßŸÑŸÜÿ≥Ÿäÿ¨", "ÿßŸÑÿπÿ∂Ÿà", "ÿßŸÑÿÆŸÑŸäÿ©", "ÿßŸÑÿ¨Ÿáÿßÿ≤ ÿßŸÑÿ≠ŸäŸàŸä"],
                        answer: 2,
                        category: "ÿπŸÑŸàŸÖ"
                    },
                    {
                        question: "ŸÖÿß ŸáŸà ÿ£ŸÉÿ®ÿ± ŸÉŸàŸÉÿ® ŸÅŸä ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ¥ŸÖÿ≥Ÿäÿ©ÿü",
                        options: ["ÿßŸÑÿ£ÿ±ÿ∂", "ÿßŸÑŸÖÿ±ŸäÿÆ", "ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä", "ÿ≤ÿ≠ŸÑ"],
                        answer: 2,
                        category: "ÿπŸÑŸàŸÖ"
                    }
                ];
            }
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿ±ŸÇ
        function loadTeams() {
            const teamsData = localStorage.getItem('connectedTeams');
            if (teamsData) {
                gameState.teams = JSON.parse(teamsData);
            } else {
                // ŸÅÿ±ŸÇ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÑÿ™ÿ¨ÿ±ÿ®ÿ©
                gameState.teams = [
                    { id: 1, teamName: "ÿßŸÑŸÅÿ±ŸäŸÇ 1", score: 0, hasAnswered: false },
                    { id: 2, teamName: "ÿßŸÑŸÅÿ±ŸäŸÇ 2", score: 0, hasAnswered: false }
                ];
            }
            
            renderTeams();
        }

        // ÿπÿ±ÿ∂ ÿßŸÑŸÅÿ±ŸÇ
        function renderTeams() {
            elements.teamsContainer.innerHTML = gameState.teams.map(team => `
                <div class="team-card ${gameState.currentTeamAnswering === team.id ? 'active' : ''}" data-team-id="${team.id}">
                    <h3>${team.teamName}</h3>
                    <div class="team-score">ÿßŸÑŸÜŸÇÿßÿ∑: ${team.score}</div>
                    <div class="team-status ${team.hasAnswered ? 'answered' : 'waiting'}">
                        ${team.hasAnswered ? '‚úì ÿ£ÿ¨ÿßÿ®' : '‚è≥ ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±'}
                    </div>
                </div>
            `).join('');

            updateTopScore();
        }

        // ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ≠ÿßŸÑŸä
        function displayQuestion() {
            if (gameState.currentQuestion >= gameState.questions.length) {
                endGame();
                return;
            }

            const question = gameState.questions[gameState.currentQuestion];
            
            elements.questionNumber.textContent = `ÿßŸÑÿ≥ÿ§ÿßŸÑ ${gameState.currentQuestion + 1}`;
            elements.questionCategory.textContent = question.category;
            elements.questionText.textContent = question.question;

            gameState.questionStartMs = Date.now();

            if (elements.progressDisplay) {
                elements.progressDisplay.textContent = `${gameState.currentQuestion + 1}/${gameState.questions.length}`;
            }

            if (elements.feedbackPanel) {
                elements.feedbackPanel.style.display = 'none';
            }
            
            // ÿπÿ±ÿ∂ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™
            elements.optionsContainer.innerHTML = question.options.map((option, index) => `
                <div class="option" data-index="${index}" onclick="selectOption(${index})">
                    ${option}
                </div>
            `).join('');
            
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
            elements.nextQuestionBtn.disabled = true;
            elements.showAnswerBtn.disabled = false;
            
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑŸÅÿ±ŸÇ
            gameState.teams.forEach(team => team.hasAnswered = false);
            gameState.currentTeamAnswering = null;
            renderTeams();
        }

        // ÿßÿÆÿ™Ÿäÿßÿ± ÿ•ÿ¨ÿßÿ®ÿ©
        function selectOption(index) {
            if (!gameState.gameActive) return;
            
            const option = elements.optionsContainer.children[index];
            const question = gameState.questions[gameState.currentQuestion];

            const start = gameState.questionStartMs || Date.now();
            
            // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©
            Array.from(elements.optionsContainer.children).forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === question.answer) {
                    opt.classList.add('correct');
                } else if (i === index) {
                    opt.classList.add('wrong');
                }
                opt.classList.add('disabled');
            });

            const elapsed = Date.now() - start;
            const optionLetter = String.fromCharCode(65 + index);
            const correctLetter = String.fromCharCode(65 + question.answer);
            if (elements.feedbackPanel) {
                elements.feedbackPanel.style.display = 'grid';
            }
            if (elements.feedbackTitle) {
                elements.feedbackTitle.textContent = `ÿ•ÿ¨ÿßÿ®ÿ™ŸÉ: ${optionLetter}`;
            }
            if (elements.feedbackLine1) {
                elements.feedbackLine1.textContent = (index === question.answer) ? 'ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©: ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©' : `ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©: ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ© (ÿßŸÑÿµÿ≠Ÿäÿ≠: ${correctLetter})`;
            }
            if (elements.feedbackLine2) {
                elements.feedbackLine2.textContent = `ÿ≤ŸÖŸÜ ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ©: ${Math.max(0, Math.round(elapsed / 100) / 10)}ÿ´`;
            }
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑ ŸÑŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ≠ÿßŸÑŸä
            if (gameState.currentTeamAnswering !== null) {
                const team = gameState.teams.find(t => t.id === gameState.currentTeamAnswering);
                if (team && !team.hasAnswered) {
                    if (index === question.answer) {
                        team.score += 10;
                        showNotification('ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©! +10 ŸÜŸÇÿßÿ∑', 'success');
                    } else {
                        showNotification('ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ©!', 'error');
                    }
                    team.hasAnswered = true;
                    renderTeams();
                }
            }

            updateTopScore();
            
            elements.showAnswerBtn.disabled = true;
            elements.nextQuestionBtn.disabled = false;
        }

        // ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ÿßŸÑŸä
        function nextQuestion() {
            gameState.currentQuestion++;
            displayQuestion();
            resetTimer();
        }

        // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©
        function showAnswer() {
            const question = gameState.questions[gameState.currentQuestion];
            Array.from(elements.optionsContainer.children).forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === question.answer) {
                    opt.classList.add('correct');
                } else {
                    opt.classList.add('wrong');
                }
                opt.classList.add('disabled');
            });
            
            elements.showAnswerBtn.disabled = true;
            elements.nextQuestionBtn.disabled = false;
        }

        // ÿ®ÿØÿ° ÿßŸÑŸÑÿπÿ®ÿ©
        function startGame() {
            gameState.gameActive = true;
            resetTimer();
            showNotification('ÿ®ÿØÿ£ÿ™ ÿßŸÑŸÑÿπÿ®ÿ©!', 'success');
        }

        // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™
        function resetTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timer = 30;
            elements.timer.textContent = gameState.timer;

            if (elements.timerRing) {
                elements.timerRing.style.setProperty('--p', '100');
            }
            
            gameState.timerInterval = setInterval(() => {
                gameState.timer--;
                elements.timer.textContent = gameState.timer;

                if (elements.timerRing) {
                    const pct = Math.max(0, Math.min(100, (gameState.timer / 30) * 100));
                    elements.timerRing.style.setProperty('--p', String(pct));
                }
                
                if (gameState.timer <= 0) {
                    clearInterval(gameState.timerInterval);
                    showNotification('ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™!', 'error');
                    nextQuestion();
                }
            }, 1000);
        }

        // ÿ•ŸÜŸáÿßÿ° ÿßŸÑŸÑÿπÿ®ÿ©
        function endGame() {
            clearInterval(gameState.timerInterval);
            gameState.gameActive = false;
            
            // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÅÿ±ŸÇ ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÇÿßÿ∑
            gameState.teams.sort((a, b) => b.score - a.score);
            
            // ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
            showResults();
        }

        // ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
        function showResults() {
            const winner = gameState.teams[0];
            
            const modal = document.createElement('div');
            modal.className = 'results-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="winner">üèÜ ${winner.teamName}</div>
                    <p>ÿßŸÑŸÅÿßÿ¶ÿ≤ ÿ®ŸÄ ${winner.score} ŸÜŸÇÿ∑ÿ©</p>
                    <div class="final-scores">
                        ${gameState.teams.map(team => `
                            <div class="score-item">
                                <span>${team.teamName}</span>
                                <span>${team.score} ŸÜŸÇÿ∑ÿ©</span>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="fas fa-redo"></i> ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ÿ®ÿØÿ° ÿßŸÑŸÑÿπÿ®ÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
