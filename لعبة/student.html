<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø¹Ø¨Ø©</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="styles-common.css" rel="stylesheet">
    <style>
        body { display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .join-container { flex-shrink: 0; }
        .join-card {
            width: min(520px, 92vw);
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 18px;
            padding: 22px 18px;
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            box-shadow: 0 18px 40px rgba(0,0,0,0.25);
        }
        .steps {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 14px;
        }
        .step {
            background: rgba(0, 0, 0, 0.22);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 14px;
            padding: 10px 8px;
            text-align: center;
            color: rgba(255,255,255,0.9);
            font-weight: 700;
            font-size: 0.92rem;
        }
        .step .step-num {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 26px;
            height: 26px;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--navis-primary), var(--navis-secondary));
            color: #001018;
            margin-left: 6px;
            font-weight: 900;
        }
        .back-link { text-align: center; margin-top: 20px; }
        .back-link a { color: var(--navis-primary); text-decoration: none; font-weight: 600; }
        .back-link a:hover { color: var(--navis-secondary); }
        .alert { border-radius: var(--radius-md); margin-bottom: 20px; }
        .btn-warning { background: linear-gradient(135deg, var(--navis-orange), #e67e22); color: #fff; border: none; border-radius: var(--radius-md); padding: 10px 18px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .btn-warning:hover { opacity: 0.9; transform: translateY(-2px); }
    </style>
</head>
<body>
    <div class="join-container">

        <div class="join-card">
            <div class="steps">
                <div class="step"><span class="step-num">1</span> Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯</div>
                <div class="step"><span class="step-num">2</span> Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚</div>
                <div class="step"><span class="step-num">3</span> Ø§Ø¨Ø¯Ø£</div>
            </div>

            <div class="header science-header">
                <h1>
                    <span class="entry-icon">ğŸ“</span>
                    Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø¹Ø¨Ø©
                </h1>
                <p>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª ÙØ±ÙŠÙ‚Ùƒ Ù„Ù„Ø¨Ø¯Ø¡</p>
            </div>
            
            <div id="alert-container"></div>
            
            <form id="join-form">
                <div class="form-group form-group-science">
                    <label for="room-code">
                        <i class="fas fa-door-open"></i>
                        ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
                    </label>
                    <input 
                        type="text" 
                        id="room-code" 
                        class="form-control" 
                        placeholder="Ø£Ø¯Ø®Ù„ 4 Ø£Ø±Ù‚Ø§Ù…"
                        maxlength="4"
                        pattern="[0-9]{4}"
                        required
                    >
                </div>
                
                <div class="form-group form-group-science">
                    <label for="team-name">
                        <i class="fas fa-users"></i>
                        Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚
                    </label>
                    <input 
                        type="text" 
                        id="team-name" 
                        class="form-control" 
                        placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙØ±ÙŠÙ‚Ùƒ"
                        required
                    >
                </div>
                
                <div class="form-group form-group-science">
                    <label for="leader-name">
                        <i class="fas fa-crown"></i>
                        Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ø¯
                    </label>
                    <input 
                        type="text" 
                        id="leader-name" 
                        class="form-control" 
                        placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ø¯"
                        required
                    >
                </div>
                
                <button type="submit" class="btn btn-science" id="join-btn">
                    <i class="fas fa-play"></i>
                    Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨Ø©
                </button>
            </form>
        </div>
        
        <div class="back-link">
            <a href="game.html">
                <i class="fas fa-arrow-right"></i>
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </a>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-sync.js"></script>
    <script>
        // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const elements = {
            roomCodeInput: document.getElementById('room-code'),
            teamNameInput: document.getElementById('team-name'),
            leaderNameInput: document.getElementById('leader-name'),
            joinForm: document.getElementById('join-form'),
            joinBtn: document.getElementById('join-btn'),
            alertContainer: document.getElementById('alert-container')
        };

        let isJoining = false;

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            elements.alertContainer.appendChild(alert);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
        function validateRoomCode(code) {
            return /^\d{4}$/.test(code);
        }

        // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©
        function joinRoom(e) {
            e.preventDefault();

            if (isJoining) {
                return;
            }
            
            const roomCode = elements.roomCodeInput.value.trim();
            const teamName = elements.teamNameInput.value.trim();
            const leaderName = elements.leaderNameInput.value.trim();
            
            if (!validateRoomCode(roomCode)) {
                showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ ØºØ±ÙØ© ØµØ§Ù„Ø­ Ù…ÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø±Ù‚Ø§Ù…', 'danger');
                return;
            }
            if (teamName.length < 3) {
                showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ (3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)', 'danger');
                return;
            }
            if (leaderName.length < 3) {
                showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ø¯ (3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)', 'danger');
                return;
            }

            isJoining = true;
            
            elements.joinBtn.disabled = true;
            elements.joinBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…...';
            
            function doJoin(roomOk, isFromFirebase) {
                if (!roomOk) {
                    elements.joinBtn.disabled = false;
                    elements.joinBtn.innerHTML = '<i class="fas fa-play"></i> Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨Ø©';
                    isJoining = false;
                    showAlert('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØºØ±ÙØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ ÙØ¹Ù‘Ù„ Firebase Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©.', 'danger');
                    return;
                }
                
                var gameStarted = localStorage.getItem('gameStarted');
                var gameInProgress = localStorage.getItem('gameInProgress');
                var currentQuestionIndex = localStorage.getItem('currentQuestionIndex');
                var questionStartTime = localStorage.getItem('questionStartTime');
                if (isFromFirebase) {
                    gameStarted = (window._roomFromServer && window._roomFromServer.gameStarted) ? 'true' : gameStarted;
                    gameInProgress = (window._roomFromServer && window._roomFromServer.gameInProgress) ? 'true' : gameInProgress;
                }
                if (gameStarted === 'true' && gameInProgress === 'true' && currentQuestionIndex !== null && questionStartTime !== null) {
                    elements.joinBtn.disabled = false;
                    elements.joinBtn.innerHTML = '<i class="fas fa-play"></i> Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨Ø©';
                    isJoining = false;
                    showAlert('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø¯ Ø¨Ø¯Ø£Øª Ø¨Ø§Ù„ÙØ¹Ù„. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©.', 'danger');
                    return;
                }
                
                var teamData = {
                    id: Date.now().toString() + '_' + Math.random().toString(36).substr(2, 6),
                    teamName: teamName,
                    leaderName: leaderName,
                    joinedAt: new Date().toISOString()
                };
                
                localStorage.setItem('currentTeam', JSON.stringify(teamData));
                localStorage.setItem('roomCode', roomCode);
                localStorage.setItem('currentRoom', roomCode);
                localStorage.setItem('roomActive', 'true');
                
                if (!isFromFirebase) {
                    var connectedTeams = JSON.parse(localStorage.getItem('connectedTeams') || '[]');
                    if (!connectedTeams.find(function(t) { return t.id === teamData.id; })) {
                        connectedTeams.push({ ...teamData, score: 0, hasAnswered: false, status: 'waiting' });
                        localStorage.setItem('connectedTeams', JSON.stringify(connectedTeams));
                    }
                }
                
                showAlert('ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ© Ø¨Ù†Ø¬Ø§Ø­! ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©...', 'success');
                isJoining = false;
                setTimeout(function() { window.location.href = 'student-waiting.html'; }, 1500);
            }
            
            if (typeof FirebaseSync !== 'undefined' && FirebaseSync.isEnabled()) {
                var teamId = Date.now().toString() + '_' + Math.random().toString(36).substr(2, 6);
                var teamData = { id: teamId, teamName: teamName, leaderName: leaderName, joinedAt: new Date().toISOString() };
                var joined = false;
                var doJoin = function() {
                    if (joined) return;
                    joined = true;
                    localStorage.setItem('currentTeam', JSON.stringify(teamData));
                    localStorage.setItem('roomCode', roomCode);
                    localStorage.setItem('currentRoom', roomCode);
                    localStorage.setItem('roomActive', 'true');
                    showAlert('ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    setTimeout(function() { window.location.href = 'student-waiting.html'; }, 500);
                };
                var timeoutId = setTimeout(function() {
                    if (!joined) {
                        console.warn('[Firebase] Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ - Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹');
                        doJoin();
                    }
                }, 5000);
                try {
                    FirebaseSync.getRoomFromServer(roomCode).then(function(room) {
                        clearTimeout(timeoutId);
                        console.log('[Firebase] Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºØ±ÙØ©:', room);
                        if (room && room.roomActive === true) {
                            var team = { id: teamId, teamName: teamName, leaderName: leaderName, joinedAt: teamData.joinedAt };
                            FirebaseSync.addTeamToRoom(roomCode, team).then(function(success) {
                                console.log('[Firebase] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ±ÙŠÙ‚:', success);
                                doJoin();
                            }).catch(function(err) {
                                console.error('[Firebase] Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ±ÙŠÙ‚:', err);
                                if (err && err.message && err.message.includes('disabled')) {
                                    showAlert('âš ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ø·Ù„Ø©. Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù…Ø­Ù„ÙŠØ§Ù‹...', 'warning');
                                }
                                doJoin();
                            });
                        } else if (room === null) {
                            console.warn('[Firebase] Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ø·Ù„Ø© Ø£Ùˆ ØºÙŠØ± Ù…ØªØ§Ø­Ø© - Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù…Ø­Ù„ÙŠØ§Ù‹');
                            showAlert('âš ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ø·Ù„Ø©. Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù…Ø­Ù„ÙŠØ§Ù‹...', 'warning');
                            doJoin();
                        } else {
                            if (!joined) {
                                elements.joinBtn.disabled = false;
                                elements.joinBtn.innerHTML = '<i class="fas fa-play"></i> Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨Ø©';
                                showAlert('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØºØ±ÙØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯.', 'danger');
                            }
                        }
                    }).catch(function(err) {
                        clearTimeout(timeoutId);
                        console.error('[Firebase] Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØºØ±ÙØ©:', err);
                        if (err && err.message && err.message.includes('disabled')) {
                            console.warn('[Firebase] Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ø·Ù„Ø© - Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù…Ø­Ù„ÙŠØ§Ù‹');
                            showAlert('âš ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ø·Ù„Ø©. Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù…Ø­Ù„ÙŠØ§Ù‹...', 'warning');
                            doJoin();
                        } else if (!joined) {
                            elements.joinBtn.disabled = false;
                            elements.joinBtn.innerHTML = '<i class="fas fa-play"></i> Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨Ø©';
                            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'danger');
                        }
                    });
                } catch (e) {
                    clearTimeout(timeoutId);
                    console.error('[Firebase] Ø®Ø·Ø£ Ø¹Ø§Ù…:', e);
                    if (e.message && e.message.includes('disabled')) {
                        showAlert('âš ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ø·Ù„Ø©. Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù…Ø­Ù„ÙŠØ§Ù‹...', 'warning');
                    }
                    doJoin();
                }
                return;
            }
            
            var currentRoom = localStorage.getItem('currentRoom');
            var isRoomActive = localStorage.getItem('roomActive') === 'true';
            if (currentRoom !== roomCode || !isRoomActive) {
                doJoin(false, false);
                return;
            }
            doJoin(true, false);
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            elements.joinForm.addEventListener('submit', joinRoom);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
            elements.roomCodeInput.addEventListener('input', function() {
                const value = this.value;
                if (value.length === 4 && !validateRoomCode(value)) {
                    this.setCustomValidity('ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© Ù…ÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·');
                } else {
                    this.setCustomValidity('');
                }
            });
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        function initPage() {
            console.log('ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨...');
            
            // Ù…Ø³Ø­ Ø£ÙŠ Ù‚ÙŠÙ… Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            console.log('Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙŠÙ… localStorage:');
            console.log('- gameStarted:', localStorage.getItem('gameStarted'));
            console.log('- gameInProgress:', localStorage.getItem('gameInProgress'));
            console.log('- currentQuestionIndex:', localStorage.getItem('currentQuestionIndex'));
            console.log('- questionStartTime:', localStorage.getItem('questionStartTime'));
            console.log('- currentRoom:', localStorage.getItem('currentRoom'));
            console.log('- roomActive:', localStorage.getItem('roomActive'));
            
            // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø¯ Ø§Ù†ØªÙ‡Øª
            const gameStarted = localStorage.getItem('gameStarted');
            const gameInProgress = localStorage.getItem('gameInProgress');
            const currentQuestionIndex = localStorage.getItem('currentQuestionIndex');
            const questionStartTime = localStorage.getItem('questionStartTime');
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø¨Ø© Ù‚Ø¯ÙŠÙ…Ø©ØŒ Ø§Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ÙˆØ®ÙŠØ§Ø± Ø§Ù„Ù…Ø³Ø­
            if (gameStarted === 'true' || gameInProgress === 'true') {
                showAlert('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø¨Ø© Ù‚Ø¯ÙŠÙ…Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©" Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.', 'warning');
                
                // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const clearBtn = document.createElement('button');
                clearBtn.className = 'btn btn-warning mt-3';
                clearBtn.innerHTML = '<i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©';
                clearBtn.onclick = clearOldGameData;
                
                const form = document.getElementById('join-form');
                form.parentNode.insertBefore(clearBtn, form.nextSibling);
            }
            
            setupEventListeners();
            
            // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
            elements.roomCodeInput.focus();
        }
        
        // Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        function clearOldGameData() {
            console.log('Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©...');
            
            // Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙ‚Ø·ØŒ Ù„Ø§ ØªØ­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºØ±ÙØ©
            localStorage.removeItem('gameStarted');
            localStorage.removeItem('gameInProgress');
            localStorage.removeItem('currentQuestionIndex');
            localStorage.removeItem('questionStartTime');
            localStorage.removeItem('gameTeams');
            localStorage.removeItem('currentQuestions');
            localStorage.removeItem('gameQuestions');
            localStorage.removeItem('selectedQuestions');
            
            // Ù„Ø§ ØªØ­Ø°Ù connectedTeams Ø­ØªÙ‰ Ù„Ø§ ØªÙÙ‚Ø¯ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ù†Ø¶Ù…Ø©
            
            console.log('ØªÙ… Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©');
            
            // Ø¥Ø²Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ù…Ø³Ø­
            const clearBtn = document.querySelector('.btn-warning');
            if (clearBtn) {
                clearBtn.remove();
            }
            
            showAlert('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨Ø©.', 'success');
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø­
            console.log('Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø­:');
            console.log('- gameStarted:', localStorage.getItem('gameStarted'));
            console.log('- gameInProgress:', localStorage.getItem('gameInProgress'));
            console.log('- currentQuestionIndex:', localStorage.getItem('currentQuestionIndex'));
            console.log('- questionStartTime:', localStorage.getItem('questionStartTime'));
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
