<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ğŸ”¬ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù… - Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="styles-common.css" rel="stylesheet">
    <style>
        .container {
            position: relative;
            z-index: 1;
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--spacing-mobile);
        }
        @media (min-width: 769px) { .container { padding: var(--spacing-tablet); } }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(74, 44, 114, 0.15), rgba(60, 179, 113, 0.1));
            border-radius: var(--radius-lg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--navis-primary);
            box-shadow: var(--shadow-glow), inset 0 0 40px rgba(60, 179, 113, 0.1);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--navis-primary), var(--navis-secondary), var(--navis-orange));
            box-shadow: 0 0 20px rgba(74, 44, 114, 0.5);
        }
        
        .header::after {
            content: 'ğŸ”¬';
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 3em;
            opacity: 0.1;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .header h1 {
            background: linear-gradient(135deg, var(--navis-secondary), var(--navis-light-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 0 0 30px rgba(60, 179, 113, 0.5);
            position: relative;
            z-index: 1;
        }

        .room-code-display {
            background: linear-gradient(135deg, rgba(74, 44, 114, 0.15), rgba(60, 179, 113, 0.1));
            border: 2px solid var(--navis-primary);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin: 20px auto;
            max-width: 400px;
            text-align: center;
            backdrop-filter: blur(15px);
            box-shadow: var(--shadow-glow);
        }

        .room-code {
            font-size: 3em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--navis-secondary), var(--navis-light-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 10px;
            margin: 15px 0;
            display: inline-block;
            background-color: rgba(74, 44, 114, 0.15);
            padding: 15px 30px;
            border-radius: var(--radius-md);
            border: 2px solid var(--navis-primary);
            box-shadow: 0 5px 20px rgba(74, 44, 114, 0.3);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 30px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--navis-primary), var(--navis-dark-blue));
            color: white;
            box-shadow: 0 5px 15px rgba(74, 44, 114, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 25px rgba(74, 44, 114, 0.5), 0 0 20px rgba(60, 179, 113, 0.3);
        }
        
        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-danger {
            background: linear-gradient(135deg, #FF4757, #EE5A6F);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3);
        }
        
        .btn-danger:hover {
            box-shadow: 0 10px 25px rgba(255, 71, 87, 0.5);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--navis-primary);
            color: var(--navis-primary);
        }
        
        .btn-outline:hover {
            background: linear-gradient(135deg, var(--navis-primary), var(--navis-dark-blue));
            color: white;
            box-shadow: 0 10px 25px rgba(74, 44, 114, 0.5);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--navis-secondary), var(--navis-dark-green));
            color: white;
            box-shadow: 0 5px 15px rgba(60, 179, 113, 0.3);
        }
        
        .btn-success:hover {
            box-shadow: 0 10px 25px rgba(60, 179, 113, 0.5);
        }

        .btn-lg {
            padding: 15px 30px;
            font-size: 1.1em;
        }

        .teams-list {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-header h2 {
            background: linear-gradient(135deg, var(--navis-primary), var(--navis-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 1.6em;
        }
        
        .section-header h2::before {
            content: 'ğŸ”¬';
            font-size: 1.2em;
            filter: grayscale(0);
        }

        .badge {
            background: linear-gradient(135deg, var(--navis-primary), var(--navis-secondary));
            color: white;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 0.95em;
            font-weight: 700;
            box-shadow: 0 3px 10px rgba(74, 44, 114, 0.3);
        }

        .team-card {
            background: linear-gradient(135deg, rgba(74, 44, 114, 0.12), rgba(60, 179, 113, 0.08));
            border: 2px solid rgba(74, 44, 114, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .team-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(74, 44, 114, 0.22), transparent);
            transition: left 0.5s ease;
        }
        
        .team-card:hover::before {
            left: 100%;
        }

        .team-card.connected {
            background: linear-gradient(135deg, rgba(74, 44, 114, 0.2), rgba(60, 179, 113, 0.15));
            border-color: var(--navis-primary);
            box-shadow: 0 5px 20px rgba(74, 44, 114, 0.3), inset 0 0 20px rgba(60, 179, 113, 0.1);
        }
        
        .team-card:hover {
            transform: translateX(-5px);
            box-shadow: 0 8px 25px rgba(74, 44, 114, 0.4);
        }

        .team-card h3 {
            background: linear-gradient(135deg, var(--navis-primary), var(--navis-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            font-weight: 700;
            font-size: 1.3em;
        }

        .team-card p {
            color: #aaa;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            margin-top: 5px;
        }

        .status.online {
            background: rgba(76, 201, 100, 0.2);
            color: #4cc964;
        }

        .status.waiting {
            background: rgba(240, 185, 11, 0.2);
            color: #f0b90b;
        }

        .questions-management {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .questions-info {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(76, 201, 240, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(76, 201, 240, 0.2);
        }

        .questions-info h3 {
            color: #4cc9f0;
            margin-bottom: 10px;
        }

        .questions-info p {
            color: #aaa;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .question-groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .question-group-card {
            background: linear-gradient(135deg, var(--navis-dark-blue), var(--navis-dark-green));
            border: 2px solid var(--navis-primary);
            border-radius: 18px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .question-group-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(74, 44, 114, 0.2) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .group-count {
            background: linear-gradient(135deg, var(--navis-primary), var(--navis-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 1.2em;
        }

        .group-type {
            color: #aaa;
            font-size: 0.8em;
            background: rgba(255, 255, 255, 0.1);
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
        }

        .selected-group-info {
            background: rgba(76, 201, 240, 0.1);
            border: 2px solid var(--navis-primary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .selected-group-info h4 {
            color: var(--navis-primary);
            margin-bottom: 10px;
        }

        .selected-group-info p {
            color: #aaa;
            margin-bottom: 15px;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--navis-dark-blue), var(--navis-dark-green));
            border: 2px solid var(--navis-primary);
            border-radius: 18px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--navis-primary), var(--navis-secondary));
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(74, 44, 114, 0.3);
        }

        .stat-card i {
            font-size: 2.5em;
            background: linear-gradient(135deg, var(--navis-primary), var(--navis-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(74, 44, 114, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 0 10px rgba(74, 44, 114, 0.5));
        }

        .stat-info {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--navis-primary), var(--navis-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 1em;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        @media (max-width: 1024px) {
            .game-controls { flex-wrap: wrap; justify-content: center; }
        }
        @media (max-width: 768px) {
            .container { padding: var(--spacing-mobile); }
            .header h1 { font-size: 1.5rem; }
            .room-code { font-size: 1.5em; padding: 8px 12px; }
            .game-controls { flex-direction: column; align-items: stretch; }
            .btn { width: 100%; max-width: 100%; }
        }
        @media (max-width: 480px) {
            .header { padding: 20px 15px; }
        }
        .teacher-code-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .teacher-code-box {
            background: linear-gradient(135deg, var(--card-bg), var(--card-bg-2));
            border: 2px solid var(--border-color);
            border-radius: 25px;
            padding: 35px;
            max-width: 380px;
            width: 90%;
            text-align: center;
        }
        .teacher-code-box h2 { color: var(--navis-primary); margin-bottom: 15px; }
        .teacher-code-box input {
            width: 100%;
            padding: 14px 18px;
            font-size: 1.2em;
            text-align: center;
            letter-spacing: 4px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            background: rgba(255,255,255,0.1);
            color: #fff;
            margin-bottom: 20px;
        }
        .teacher-code-box .code-error { color: #ff4757; margin-bottom: 10px; display: none; }
    </style>
</head>
<body>
    <div id="teacher-code-overlay" class="teacher-code-overlay" style="display:none;">
        <div class="teacher-code-box">
            <h2><i class="fas fa-lock"></i> Ø±Ù…Ø² Ø§Ù„Ù…Ø¹Ù„Ù…</h2>
            <p style="color: rgba(255,255,255,0.8); margin-bottom: 20px;">Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø¹Ù„Ù… Ù„Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</p>
            <p id="teacher-code-error" class="code-error"><i class="fas fa-exclamation-circle"></i> Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­</p>
            <input type="password" id="teacher-code-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²" maxlength="20" autocomplete="off">
            <button type="button" class="btn btn-primary" id="teacher-code-submit" style="width: 100%;">
                <i class="fas fa-check"></i> Ø¯Ø®ÙˆÙ„
            </button>
        </div>
    </div>
    <div class="container">
        <header class="header">
            <div class="teacher-info">
                <h1><span class="entry-icon">ğŸ”¬</span> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù…</h1>
                <div class="teacher-details">
                    <span class="teacher-id">Ø§Ù„Ù…Ø¹Ù„Ù…: <span id="teacher-id-display">----</span></span>
                    <span class="room-status">Ø­Ø§Ù„Ø© Ø§Ù„ØºØ±ÙØ©: <span id="room-status">Ù†Ø´Ø·Ø©</span></span>
                </div>
            </div>
            <div id="room-code-display">
                <p>ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©: <span id="room-code" class="room-code">----</span></p>
                <button class="btn btn-primary" id="copy-code">
                    <i class="far fa-copy"></i> Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
                </button>
                <p class="hint">Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</p>
            </div>
        </header>
        
        <div class="teams-list">
            <div class="section-header">
                <h2><i class="fas fa-users"></i> Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…ØªØµÙ„Ø©</h2>
                <span class="badge" id="connected-count">0 Ù…ØªØµÙ„</span>
            </div>
            <div id="connected-teams">
                <div class="empty-state">
                    <i class="fas fa-user-clock"></i>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±Ù‚ Ù…ØªØµÙ„Ø© Ø¨Ø¹Ø¯</p>
                    <small>Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ÙØ±Ù‚ Ù‡Ù†Ø§ Ø¹Ù†Ø¯ Ø§ØªØµØ§Ù„Ù‡Ù…</small>
                </div>
            </div>
        </div>
        
        <div class="game-controls">
            <button class="btn btn-primary btn-lg" id="start-game" disabled>
                <i class="fas fa-play"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            </button>
            <button class="btn btn-outline" id="settings-btn">
                <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
            <button class="btn btn-outline" id="questions-btn">
                <i class="fas fa-question-circle"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            </button>
            <button class="btn btn-danger" id="reset-game">
                <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            </button>
        </div>
        
        <div class="game-stats">
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <div class="stat-info">
                    <span class="stat-value" id="teams-count">0</span>
                    <span class="stat-label">ÙØ±ÙŠÙ‚ Ù…ØªØµÙ„</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-question-circle"></i>
                <div class="stat-info">
                    <span class="stat-value" id="questions-count">0</span>
                    <span class="stat-label">Ø³Ø¤Ø§Ù„ Ù…ØªØ§Ø­</span>
                </div>
            </div>
        </div>
        
        <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
        <div class="questions-management">
            <div class="section-header">
                <h2><i class="fas fa-flask"></i> Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
                <button class="btn btn-primary" id="toggle-questions-btn">
                    <i class="fas fa-chevron-down"></i> Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                </button>
            </div>
            
            <div id="questions-selector" style="display: none;">
                <div class="questions-info">
                    <h3>Ø§Ø®ØªØ± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„Ù„Ø¹Ø¨:</h3>
                    <p>4 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£ÙˆÙ„Ù‰: 21 Ø³Ø¤Ø§Ù„ Ù„ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© | 8 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø«Ø§Ù†ÙŠØ©: 19 Ø³Ø¤Ø§Ù„ Ù„ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©</p>
                    <p>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 236 Ø³Ø¤Ø§Ù„ - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù„Ù„Ø¨Ø¯Ø¡ Ù…Ù†Ù‡Ø§</p>
                </div>
                
                <div id="question-groups" class="question-groups-grid">
                    <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù‡Ù†Ø§ -->
                </div>
                
                <div class="selected-group-info" id="selected-group-info" style="display: none;">
                    <h4>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©: <span id="selected-group-name"></span></h4>
                    <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: <span id="selected-group-count"></span> Ø³Ø¤Ø§Ù„</p>
                    <button class="btn btn-success" id="confirm-group-btn">
                        <i class="fas fa-check"></i> ØªØ£ÙƒÙŠØ¯ ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-sync.js"></script>
    <!-- Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
    <script src="questions-data.js"></script>

    <script>
        var TEACHER_CODE = '4570211';
        function isTeacherVerified() {
            return sessionStorage.getItem('teacherCodeVerified') === 'true';
        }
        function setTeacherVerified() {
            sessionStorage.setItem('teacherCodeVerified', 'true');
        }
        function showTeacherCodeOverlay() {
            var el = document.getElementById('teacher-code-overlay');
            if (el) el.style.display = 'flex';
        }
        function hideTeacherCodeOverlay() {
            var el = document.getElementById('teacher-code-overlay');
            if (el) el.style.display = 'none';
        }
        function setupTeacherCodeCheck(onSuccess) {
            var overlay = document.getElementById('teacher-code-overlay');
            var input = document.getElementById('teacher-code-input');
            var submit = document.getElementById('teacher-code-submit');
            var error = document.getElementById('teacher-code-error');
            if (!overlay || !input || !submit || !error) return;
            function checkCode() {
                var val = (input.value || '').trim();
                error.style.display = 'none';
                if (val === TEACHER_CODE) {
                    setTeacherVerified();
                    hideTeacherCodeOverlay();
                    if (typeof onSuccess === 'function') onSuccess();
                    return true;
                }
                error.style.display = 'block';
                input.value = '';
                input.focus();
                return false;
            }
            submit.addEventListener('click', function() {
                checkCode();
            });
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    checkCode();
                }
            });
        }
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const appState = {
            roomCode: '',
            isHost: true,
            teams: [],
            gameInProgress: false,
            questions: [],
            questionGroups: [],
            selectedGroup: null,
            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
            gameSettings: {
                maxTeams: 4,
                advancedScoring: true,
                cardsEnabled: true,
                bankSystem: true,
                questionTime: 30
            },
            // Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
            availableCards: [
                { id: 'shield', name: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø±ØµÙŠØ¯', cost: 3, icon: 'ğŸ›¡ï¸', description: 'ØªÙ…Ù†Ø¹ Ø³Ø­Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Ø§Ù„ÙØ±ÙŠÙ‚ Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯' },
                { id: 'eliminate', name: 'Ø­Ø°Ù Ø®ÙŠØ§Ø±Ø§Øª', cost: 2, icon: 'âŒ', description: 'Ø­Ø°Ù Ø®ÙŠØ§Ø±ÙŠÙ† Ø®Ø§Ø·Ø¦ÙŠÙ† Ù…Ù† Ø§Ù„Ø³Ø¤Ø§Ù„' },
                { id: 'freeze', name: 'ØªØ¬Ù…ÙŠØ¯ ÙØ±ÙŠÙ‚', cost: 4, icon: 'ğŸ§Š', description: 'ØªØ¬Ù…ÙŠØ¯ ÙØ±ÙŠÙ‚ ÙˆØ§Ø­Ø¯ Ù„Ù…Ø¯Ø© 5-10 Ø«ÙˆØ§Ù†ÙŠ' }
            ],
            externalQuestions: [
                {
                    question: "Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± ÙƒÙˆÙƒØ¨ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©ØŸ",
                    options: ["Ø§Ù„Ø£Ø±Ø¶", "Ø§Ù„Ù…Ø±ÙŠØ®", "Ø§Ù„Ù…Ø´ØªØ±ÙŠ", "Ø²Ø­Ù„"],
                    answer: 2,
                    category: "Ø¹Ù„ÙˆÙ…"
                },
                {
                    question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ",
                    options: ["5", "6", "7", "8"],
                    answer: 2,
                    category: "Ø¬ØºØ±Ø§ÙÙŠØ§"
                },
                {
                    question: "Ù…Ù† Ù‡Ùˆ Ù…Ø®ØªØ±Ø¹ Ø§Ù„Ù…ØµØ¨Ø§Ø­ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØŸ",
                    options: ["Ù†ÙŠÙƒÙˆÙ„Ø§ ØªØ³Ù„Ø§", "ØªÙˆÙ…Ø§Ø³ Ø¥Ø¯ÙŠØ³ÙˆÙ†", "Ø£Ù„Ø¨Ø±Øª Ø£ÙŠÙ†Ø´ØªØ§ÙŠÙ†", "Ø¨Ù†Ø¬Ø§Ù…ÙŠÙ† ÙØ±Ø§Ù†ÙƒÙ„ÙŠÙ†"],
                    answer: 1,
                    category: "ØªØ§Ø±ÙŠØ®"
                },
                {
                    question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© ÙØ±Ù†Ø³Ø§ØŸ",
                    options: ["Ù„Ù†Ø¯Ù†", "Ø¨Ø±Ù„ÙŠÙ†", "Ù…Ø¯Ø±ÙŠØ¯", "Ø¨Ø§Ø±ÙŠØ³"],
                    answer: 3,
                    category: "Ø¬ØºØ±Ø§ÙÙŠØ§"
                }
            ],
            allQuestions: []
        };

        // Ù‚Ø±Ø§Ø¡Ø© Ø£Ø³Ø¦Ù„Ø© `questions-data.js` Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
        function getAllQuestionsSafely() {
            try {
                if (typeof ALL_QUESTIONS !== 'undefined' && Array.isArray(ALL_QUESTIONS)) {
                    return ALL_QUESTIONS;
                }
            } catch (e) {
                // ignore
            }
            return [];
        }

        async function prepareQuestionsData() {
            // 1) Ø¬Ø±Ù‘Ø¨ Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø¯Ù…Ø¬
            let questions = getAllQuestionsSafely();

            // 2) Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‚Ù„ÙŠÙ„/ÙØ§Ø±ØºØŒ Ø¬Ø±Ù‘Ø¨ Ù…Ù„Ù Ø§Ù„Ù†Øµ `Ø§Ù„Ø§Ø³Ø§Ù„Ù‡` (Ù…ÙÙŠØ¯ Ù„Ùˆ ÙƒØ§Ù† ÙÙŠÙ‡ ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©)
            if (questions.length < 100) {
                try {
                    const fromText = await loadQuestionsFromTextAsset();
                    if (Array.isArray(fromText) && fromText.length > questions.length) {
                        questions = fromText;
                    }
                } catch (e) {
                    console.warn('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø³Ø§Ù„Ù‡ Ø¹Ø¨Ø± fetch:', e);
                }
            }

            appState.allQuestions = questions;

            if (elements.questionsCount) {
                elements.questionsCount.textContent = questions.length;
            }

            console.log('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©:', questions.length);
        }

        // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const elements = {
            roomCode: document.getElementById('room-code'),
            copyCodeBtn: document.getElementById('copy-code'),
            startButton: document.getElementById('start-game'),
            resetButton: document.getElementById('reset-game'),
            settingsBtn: document.getElementById('settings-btn'),
            connectedTeams: document.getElementById('connected-teams'),
            connectedCount: document.getElementById('connected-count'),
            teamsCount: document.getElementById('teams-count'),
            questionsCount: document.getElementById('questions-count'),
            toggleQuestionsBtn: document.getElementById('toggle-questions-btn'),
            questionsSelector: document.getElementById('questions-selector'),
            questionGroups: document.getElementById('question-groups'),
            selectedGroupInfo: document.getElementById('selected-group-info'),
            selectedGroupName: document.getElementById('selected-group-name'),
            selectedGroupCount: document.getElementById('selected-group-count'),
            confirmGroupBtn: document.getElementById('confirm-group-btn')
        };

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateUI() {
            if (elements.roomCode) {
                elements.roomCode.textContent = appState.roomCode;
            }
            if (elements.copyCodeBtn) {
                elements.copyCodeBtn.disabled = !appState.roomCode;
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
        async function createRoom() {
            try {
                console.log('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©...');

                // Ù„Ùˆ ÙÙŠÙ‡ ØºØ±ÙØ© Ø³Ø§Ø¨Ù‚Ø© Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ø§Ø¹ØªØ¨Ø±Ù‡Ø§ ØºÙŠØ± Ù†Ø´Ø·Ø© ÙˆØ§Ø¨Ø¯Ø£ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¯ÙˆÙ† Ø¥Ø²Ø¹Ø§Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                try {
                    localStorage.setItem('teacherRoomActive', 'false');
                } catch (e) {
                    // ignore
                }

                // Ù…Ø³Ø­ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                localStorage.removeItem('connectedTeams');
                appState.connectedTeams = [];

                // ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ ØºØ±ÙØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ù…Ø¹ ØªØ¬Ù†Ø¨ Ø§Ù„ØªØµØ§Ø¯Ù… Ø¹Ù„Ù‰ Firebase Ø¥Ù† ÙƒØ§Ù† Ù…ÙØ¹Ù‘Ù„)
                var attempts = 0;
                var newCode = '';
                while (attempts < 20) {
                    attempts++;
                    newCode = Math.floor(1000 + Math.random() * 9000).toString();

                    // Ø¥Ø°Ø§ Firebase Ù…ØªØ§Ø­ØŒ ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…
                    if (typeof FirebaseSync !== 'undefined' && typeof FirebaseSync.getRoomFromServer === 'function') {
                        try {
                            var room = await FirebaseSync.getRoomFromServer(newCode);
                            if (room && room.roomActive === true) {
                                continue;
                            }
                        } catch (e) {
                            // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ØŒ Ù„Ø§ ØªÙ…Ù†Ø¹ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ© (Ø³ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)
                        }
                    }
                    break;
                }
                appState.roomCode = newCode;

                // Ø­ÙØ¸ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© ÙÙŠ localStorage Ù…Ø¹ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ù…Ø¹Ù„Ù…
                const teacherId = 'teacher_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('teacherRoomCode', appState.roomCode);
                localStorage.setItem('currentRoom', appState.roomCode);
                localStorage.setItem('roomActive', 'true');
                localStorage.setItem('teacherRoomActive', 'true');
                localStorage.setItem('teacherId', teacherId);
                localStorage.setItem('teacherRoomCreatedAt', new Date().toISOString());

                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± (Firebase) Ù„ÙŠØ¯Ø®Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ù† Ø£Ø¬Ù‡Ø²Ø© Ø£Ø®Ø±Ù‰
                if (typeof FirebaseSync !== 'undefined' && typeof FirebaseSync.createRoomOnServer === 'function') {
                    FirebaseSync.createRoomOnServer(appState.roomCode).then(function(ok) {
                        if (ok) {
                            console.log('[Firebase] ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±');
                            if (appState._firebaseUnsubscribe) appState._firebaseUnsubscribe();
                            appState._firebaseUnsubscribe = FirebaseSync.onRoomUpdate(appState.roomCode, function(data) {
                                if (data && data.teams) {
                                    var arr = Object.keys(data.teams).map(function(k) { return data.teams[k]; });
                                    appState.connectedTeams = arr;
                                    localStorage.setItem('connectedTeams', JSON.stringify(arr));
                                    renderTeams(arr);
                                    var cnt = arr.length;
                                    if (elements.connectedCount) elements.connectedCount.textContent = cnt + ' Ù…ØªØµÙ„';
                                    if (elements.teamsCount) elements.teamsCount.textContent = cnt;
                                    if (elements.startButton) elements.startButton.disabled = cnt < 2;
                                }
                            });
                        } else {
                            console.warn('[Firebase] Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ© - ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Firebase ÙÙŠ firebase-config.js');
                        }
                    });
                }

                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                updateUI();

                console.log('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©:', appState.roomCode);
                showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        function loadQuestions() {
            // Ø£ÙˆÙ„Ø§Ù‹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
            try {
                const questionsFromFile = loadQuestionsFromTextFile();
                if (questionsFromFile.length > 0) {
                    appState.questions = questionsFromFile;
                    console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„', questionsFromFile.length, 'Ø³Ø¤Ø§Ù„ Ù…Ù† Ø§Ù„Ù…Ù„Ù');
                    updateQuestionsCount();
                    return;
                }
            } catch (error) {
                console.log('Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ù„ÙØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
            }
            
            // ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            const sampleQuestions = [
                {
                    question: 'Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŸ',
                    options: ['Ø¬Ø¯Ø©', 'Ø§Ù„Ø±ÙŠØ§Ø¶', 'Ø§Ù„Ø¯Ù…Ø§Ù…', 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©'],
                    answer: 1,
                    category: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©'
                },
                {
                    question: 'Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± ÙƒÙˆÙƒØ¨ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©ØŸ',
                    options: ['Ø§Ù„Ø£Ø±Ø¶', 'Ø§Ù„Ù…Ø´ØªØ±ÙŠ', 'Ø²Ø­Ù„', 'Ø§Ù„Ù…Ø±ÙŠØ®'],
                    answer: 1,
                    category: 'Ø¹Ù„ÙˆÙ…'
                }
            ];
            
            appState.questions = sampleQuestions;
            console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„', sampleQuestions.length, 'Ø³Ø¤Ø§Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠ');
            updateQuestionsCount();
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        function toggleQuestions() {
            const isVisible = elements.questionsSelector.style.display === 'block';
            
            if (isVisible) {
                elements.questionsSelector.style.display = 'none';
                elements.toggleQuestionsBtn.innerHTML = '<i class="fas fa-chevron-down"></i> Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø³Ø¦Ù„Ø©';
            } else {
                elements.questionsSelector.style.display = 'block';
                elements.toggleQuestionsBtn.innerHTML = '<i class="fas fa-chevron-up"></i> Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©';
                
                // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ÙØªØ­
                if (appState.questionGroups.length === 0) {
                    initializeQuestions();
                }
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ø¹Ù†Ø¯ ÙØªØ­ Ù‚Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª)
        function initializeQuestions() {
            try {
                console.log('Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©...');
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                const questions = (appState.allQuestions && appState.allQuestions.length > 0)
                    ? appState.allQuestions
                    : getAllQuestionsSafely();
                
                if (questions.length === 0) {
                    showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…Ø­Ù…Ù„Ø©', 'error');
                    return;
                }
                
                // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„Ù€ 12 Ù…Ø¬Ù…ÙˆØ¹Ø©
                const groups = divideQuestionsIntoGroups(questions);
                
                appState.questionGroups = groups;
                displayQuestionGroups(groups);
                
                // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                const questionsCountElement = document.getElementById('questions-count');
                const questionsLoadedBadgeElement = document.getElementById('questions-loaded-badge');
                
                if (questionsCountElement) {
                    questionsCountElement.textContent = questions.length;
                }
                if (questionsLoadedBadgeElement) {
                    questionsLoadedBadgeElement.textContent = `${questions.length} Ø³Ø¤Ø§Ù„ Ù…Ø­Ù…Ù„`;
                }
                
                console.log('ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­:', questions.length, 'Ø³Ø¤Ø§Ù„');
                showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${questions.length} Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:', error);
                showNotification('ÙØ´Ù„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©', 'error');
            }
        }

        // (Ù„Ù„ØªÙˆØ§ÙÙ‚) Ø¯Ø§Ù„Ø© Ù‚Ø¯ÙŠÙ…Ø© ÙƒØ§Ù†Øª ØªØ­Ù…Ù„ Ù…Ù† Ù…Ù„Ù/Ù†Øµ â€” Ø§Ù„Ø¢Ù† ØªØ¹ÙŠØ¯ Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
        async function loadQuestionsFromFile() {
            const questions = (appState.allQuestions && appState.allQuestions.length > 0)
                ? appState.allQuestions
                : getAllQuestionsSafely();
            return questions;
        }

        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø§Ù„Ù†Øµ
        function parseQuestionsFromText(text) {
            const questions = [];
            const lines = text.split('\n').filter(line => line.trim());
            
            let currentQuestion = {};
            let questionNumber = 1;
            
            console.log('Ø¨Ø¯Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø§Ù„Ù†Øµ...');
            console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø·Ø±:', lines.length);
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ø¨Ø±Ù‚Ù…
                if (line.match(/^\d+\./)) {
                    // Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    if (currentQuestion.question && currentQuestion.options && currentQuestion.options.length >= 4 && currentQuestion.answer >= 0) {
                        questions.push(currentQuestion);
                        console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„:', currentQuestion.question, 'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:', currentQuestion.answer);
                    }
                    
                    // Ø¨Ø¯Ø¡ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
                    currentQuestion = {
                        question: line.replace(/^\d+\.\s*/, ''),
                        options: [],
                        answer: -1,
                        category: "Ø¹Ù„Ù…ÙŠ"
                    };
                    continue;
                }

                // ØªØ¬Ø§Ù‡Ù„ Ø£ÙŠ Ø³Ø·Ø± Ù‚Ø¨Ù„ Ø£ÙˆÙ„ Ø³Ø¤Ø§Ù„
                if (!currentQuestion.question) continue;

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ù‚Ø¯ ØªÙƒÙˆÙ† Ø¨Ø¯ÙˆÙ† Ø­Ø±ÙˆÙ: "Ø§Ù„Ù†Ø³ÙŠØ¬" Ø£Ùˆ Ù…Ø¹ (ØµØ­))
                const isCorrect = line.includes('(ØµØ­)') || line.includes('(âœ“)') || line.includes('âœ“');
                const cleanLine = line
                    .replace(/\(ØµØ­\)/g, '')
                    .replace(/\(âœ“\)/g, '')
                    .replace(/âœ“/g, '')
                    .replace(/^[Ø£-Ø¯]\.\s*/, '')   // Ø¥Ù† ÙˆÙØ¬Ø¯Øª Ø­Ø±ÙˆÙ
                    .replace(/^[Ø£-Ø¯]\)\s*/, '')
                    .replace(/^[Ø£-Ø¯]\s+/, '')
                    .trim();

                if (cleanLine.length === 0) continue;

                currentQuestion.options.push(cleanLine);
                if (isCorrect) {
                    currentQuestion.answer = currentQuestion.options.length - 1;
                }
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ø®ÙŠØ±
            if (currentQuestion.question && currentQuestion.options && currentQuestion.options.length >= 4 && currentQuestion.answer >= 0) {
                questions.push(currentQuestion);
                console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ø®ÙŠØ±:', currentQuestion.question, 'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:', currentQuestion.answer);
            }
            
            console.log('ØªÙ… ØªØ­Ù„ÙŠÙ„', questions.length, 'Ø³Ø¤Ø§Ù„');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
            questions.forEach((q, index) => {
                if (q.answer === -1) {
                    console.warn('Ø³Ø¤Ø§Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©:', index + 1, q.question);
                } else {
                    console.log('Ø³Ø¤Ø§Ù„', index + 1, 'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:', q.answer, q.options[q.answer]);
                }
            });
            
            return questions;
        }

        // Ù…Ù„Ø§Ø­Ø¸Ø©: ÙƒØ§Ù†Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ­Ù…ÙŠÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ ÙˆØªÙØ±Ø¬Ø¹ [] Ù…Ø¤Ù‚ØªØ§Ù‹.
        // Ø§Ù„Ø¢Ù† Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙŠÙØ­Ù…Ù‘Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø¹Ø¨Ø± <script src="questions-data.js">.
        function getEmbeddedQuestions() {
            return getAllQuestionsSafely();
        }

        // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„Ù€ 12 Ù…Ø¬Ù…ÙˆØ¹Ø© (4 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙÙŠÙ‡Ø§ 20 Ø³Ø¤Ø§Ù„ØŒ 8 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙÙŠÙ‡Ø§ 19 Ø³Ø¤Ø§Ù„)
        function divideQuestionsIntoGroups(questions) {
            const groups = [];
            let questionIndex = 0;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            const totalQuestions = questions.length;
            console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:', totalQuestions);
            
            // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ù„ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            if (totalQuestions >= 20) {
                // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„Ù€ 12 Ù…Ø¬Ù…ÙˆØ¹Ø©
                const questionsPerGroup = Math.floor(totalQuestions / 12);
                const remainingQuestions = totalQuestions % 12;
                
                console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©:', questionsPerGroup);
                console.log('Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:', remainingQuestions);
                
                for (let i = 0; i < 12; i++) {
                    const groupQuestions = questions.slice(questionIndex, questionIndex + questionsPerGroup + (i < remainingQuestions ? 1 : 0));
                    questionIndex += questionsPerGroup + (i < remainingQuestions ? 1 : 0);
                    
                    groups.push({
                        id: i + 1,
                        name: `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${i + 1}`,
                        questions: groupQuestions,
                        totalQuestions: groupQuestions.length,
                        hasExternal: true
                    });
                }
            } else {
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø£Ù‚Ù„ Ù…Ù† 20ØŒ Ù†Ø¶Ø¹Ù‡Ø§ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
                groups.push({
                    id: 1,
                    name: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© 1",
                    questions: questions,
                    totalQuestions: totalQuestions,
                    hasExternal: false
                });
            }
            
            return groups;
        }

        // Ø¹Ø±Ø¶ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        function displayQuestionGroups(groups) {
            elements.questionGroups.innerHTML = '';
            
            groups.forEach(group => {
                const groupCard = document.createElement('div');
                groupCard.className = 'question-group-card';
                
                // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                const groupType = group.id <= 4 ? 'primary' : 'secondary';
                const typeText = group.id <= 4 ? 'Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒØ¨ÙŠØ±Ø©' : 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¹Ø§Ø¯ÙŠØ©';
                const questionCount = group.totalQuestions;
                
                groupCard.innerHTML = `
                    <div class="group-number group-${groupType}">${group.id}</div>
                    <h4>${group.name}</h4>
                    <div class="group-count">${questionCount} Ø³Ø¤Ø§Ù„</div>
                    <div class="group-type">${typeText}</div>
                `;
                
                groupCard.addEventListener('click', (evt) => selectQuestionGroup(evt, group));
                elements.questionGroups.appendChild(groupCard);
            });
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        function selectQuestionGroup(evt, group) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
            document.querySelectorAll('.question-group-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add('selected');
            }
            
            appState.selectedGroup = group;
            appState.questions = Array.isArray(group.questions) ? group.questions : [];
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            elements.selectedGroupName.textContent = group.name;
            elements.selectedGroupCount.textContent = group.totalQuestions;
            elements.selectedGroupInfo.style.display = 'block';
        }

        // ØªØ£ÙƒÙŠØ¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
        function confirmQuestionGroup() {
            if (!appState.selectedGroup) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ø³Ø¦Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            // ØªØ¹ÙŠÙŠÙ† Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ÙƒØ£Ø³Ø¦Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            appState.questions = appState.selectedGroup.questions;
            
            console.log('ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:', appState.selectedGroup.name);
            console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:', appState.questions.length);
            
            showNotification(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${appState.selectedGroup.name} (${appState.questions.length} Ø³Ø¤Ø§Ù„)`, 'success');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
            elements.selectedGroupInfo.style.display = 'none';
        }

        // ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ø¦Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        function loadSampleQuestions() {
            const sampleQuestions = [
                {
                    question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŸ",
                    options: ["Ø¬Ø¯Ø©", "Ø§Ù„Ø±ÙŠØ§Ø¶", "Ø§Ù„Ø¯Ù…Ø§Ù…", "Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©"],
                    answer: 1,
                    category: "Ø¬ØºØ±Ø§ÙÙŠØ§"
                },
                {
                    question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©ØŸ",
                    options: ["364", "365", "366", "363"],
                    answer: 1,
                    category: "Ø¹Ù„Ù…ÙŠ"
                }
            ];
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
            const groups = [];
            for (let i = 0; i < 12; i++) {
                const groupQuestions = [...sampleQuestions];
                if (i < 4) {
                    groupQuestions.push(appState.externalQuestions[i]);
                }
                
                groups.push({
                    id: i + 1,
                    name: `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${i + 1}`,
                    questions: groupQuestions,
                    totalQuestions: groupQuestions.length,
                    hasExternal: i < 4
                });
            }
            
            appState.questionGroups = groups;
            displayQuestionGroups(groups);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„ØµÙØ­Ø©
            document.body.appendChild(notification);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†Ù
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function updateQuestionsCount() {
            if (elements.questionsCount) {
                elements.questionsCount.textContent = appState.questions.length;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ù‚
        function updateTeamsStatus() {
            try {
                var teamsData = localStorage.getItem('connectedTeams');
                var teams = teamsData ? JSON.parse(teamsData) : [];
                appState.connectedTeams = teams;
                renderTeams(teams);
                var connectedCount = teams.length;
                if (elements.connectedCount) elements.connectedCount.textContent = connectedCount + ' Ù…ØªØµÙ„';
                if (elements.teamsCount) elements.teamsCount.textContent = connectedCount;
            } catch (error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ù‚:', error);
            }
        }

        // Ø¨Ø¯Ø¡ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ù‚
        function startTeamUpdates() {
            updateTeamsStatus();
            setInterval(updateTeamsStatus, 2000);
        }

        // Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
        function copyRoomCode() {
            if (!appState.roomCode) return;
            
            navigator.clipboard.writeText(appState.roomCode).then(() => {
                alert('ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©: ' + appState.roomCode);
            }).catch(err => {
                console.error('ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ù†Øµ: ', err);
                // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù†Ø³Ø® Ø§Ù„Ù†Øµ
                const textarea = document.createElement('textarea');
                textarea.value = appState.roomCode;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©: ' + appState.roomCode);
            });
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // Ø²Ø± Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
            if (elements.copyCodeBtn) {
                elements.copyCodeBtn.addEventListener('click', copyRoomCode);
            }
            
            // Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            if (elements.toggleQuestionsBtn) {
                elements.toggleQuestionsBtn.addEventListener('click', toggleQuestions);
            }
            
            // Ø²Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
            if (elements.confirmGroupBtn) {
                elements.confirmGroupBtn.addEventListener('click', confirmQuestionGroup);
            }
            
            // Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            if (elements.startButton) {
                elements.startButton.addEventListener('click', startGame);
            }
            
            // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
            if (elements.resetButton) {
                elements.resetButton.addEventListener('click', resetGame);
            }
            
            // Ø²Ø± ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            if (elements.settingsBtn) {
                elements.settingsBtn.addEventListener('click', () => {
                    alert('Ø³ÙŠØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹');
                });
            }
            
            // ÙØªØ­ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            const questionsBtn = document.getElementById('questions-btn');
            if (questionsBtn) {
                questionsBtn.addEventListener('click', openQuestionsManager);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ÙØ±Ù‚
        function renderTeams(teams) {
            console.log('=== Ø¨Ø¯Ø¡ renderTeams ===');
            console.log('Ø§Ù„ÙØ±Ù‚ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©:', teams);
            console.log('Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚:', teams.length);
            
            const container = elements.connectedTeams;
            console.log('Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§ÙˆÙŠØ©:', container);
            
            if (!container) {
                console.error('Ø¹Ù†ØµØ± connectedTeams ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                return;
            }
            
            if (teams.length === 0) {
                console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±Ù‚ØŒ Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±ØºØ©');
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-clock"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±Ù‚ Ù…ØªØµÙ„Ø© Ø¨Ø¹Ø¯</p>
                        <small>Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ÙØ±Ù‚ Ù‡Ù†Ø§ Ø¹Ù†Ø¯ Ø§ØªØµØ§Ù„Ù‡Ù…</small>
                    </div>
                `;
                return;
            }
            
            console.log('Ø¹Ø±Ø¶ Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©');
            container.innerHTML = teams.map(team => `
                <div class="team-card" id="team-${team.id}">
                    <div class="team-info">
                        <h3>${team.teamName || 'ÙØ±ÙŠÙ‚ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</h3>
                        <p class="leader"><i class="fas fa-crown"></i> ${team.leaderName || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø§Ø¦Ø¯'}</p>
                        <p class="join-time"><i class="fas fa-clock"></i> Ø§Ù†Ø¶Ù…: ${new Date(team.joinedAt).toLocaleTimeString('ar-SA')}</p>
                        <div class="team-stats">
                            <span class="team-score">Ø§Ù„Ù†Ù‚Ø§Ø·: ${team.score || 0}</span>
                            <span class="team-bank">Ø§Ù„Ø¨Ù†Ùƒ: ${team.bank || 0}</span>
                            <span class="team-cards">Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: ${team.cards ? team.cards.length : 0}</span>
                        </div>
                    </div>
                    <div class="team-actions">
                        <span class="status online"><i class="fas fa-circle"></i> Ù…ØªØµÙ„</span>
                        <button class="btn btn-danger btn-sm" onclick="removeTeam('${team.id}')" title="Ø·Ø±Ø¯ Ø§Ù„ÙØ±ÙŠÙ‚">
                            <i class="fas fa-user-times"></i> Ø·Ø±Ø¯
                        </button>
                    </div>
                </div>
            `).join('');
            
            console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙØ±Ù‚ Ø¨Ù†Ø¬Ø§Ø­');
            console.log('=== Ù†Ù‡Ø§ÙŠØ© renderTeams ===');
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…ØªØµÙ„Ø©
            if (elements.connectedCount) {
                elements.connectedCount.textContent = `${teams.length} Ù…ØªØµÙ„`;
            }
            
            // ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚
            if (elements.startButton) {
                elements.startButton.disabled = teams.length < 2;
            }
        }

        // Ø·Ø±Ø¯ ÙØ±ÙŠÙ‚
        function removeTeam(teamId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø·Ø±Ø¯ Ù‡Ø°Ø§ Ø§Ù„ÙØ±ÙŠÙ‚ØŸ')) {
                return;
            }
            
            try {
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                let connectedTeams = JSON.parse(localStorage.getItem('connectedTeams') || '[]');
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø·Ø±Ø¯Ù‡
                const teamToRemove = connectedTeams.find(team => team.id === teamId);
                
                if (!teamToRemove) {
                    showNotification('Ø§Ù„ÙØ±ÙŠÙ‚ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                // Ø­Ø°Ù Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø¯Ø¯
                connectedTeams = connectedTeams.filter(team => team.id !== teamId);
                
                // ØªØ­Ø¯ÙŠØ« localStorage
                localStorage.setItem('connectedTeams', JSON.stringify(connectedTeams));
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                appState.connectedTeams = connectedTeams;
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø·Ø±ÙˆØ¯ (Ù…Ø­Ø§ÙƒØ§Ø©)
                localStorage.setItem('kickedTeam_' + teamId, JSON.stringify({
                    kicked: true,
                    kickedAt: new Date().toISOString(),
                    reason: 'ØªÙ… Ø·Ø±Ø¯Ùƒ Ù…Ù† Ø§Ù„ØºØ±ÙØ© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¹Ù„Ù…'
                }));
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                updateTeamsStatus();
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                showNotification(`ØªÙ… Ø·Ø±Ø¯ Ø§Ù„ÙØ±ÙŠÙ‚ "${teamToRemove.teamName}" Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                
                console.log('ØªÙ… Ø·Ø±Ø¯ Ø§Ù„ÙØ±ÙŠÙ‚:', teamToRemove.teamName);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø·Ø±Ø¯ Ø§Ù„ÙØ±ÙŠÙ‚:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø·Ø±Ø¯ Ø§Ù„ÙØ±ÙŠÙ‚', 'error');
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„ØµÙØ­Ø©
            document.body.appendChild(notification);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†Ù
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ÙØªØ­ Ù…Ø¯ÙŠØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        function openQuestionsManager() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-question-circle"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="questions-stats">
                            <div class="stat-item">
                                <span class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</span>
                                <span class="stat-value">${appState.questions.length}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª:</span>
                                <span class="stat-value">${getCategoriesCount()}</span>
                            </div>
                        </div>
                        <div class="questions-actions">
                            <button class="btn btn-primary" onclick="importQuestionsFromUserFile()">
                                <i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ù…Ù„Ù
                            </button>
                            <button class="btn btn-outline" onclick="addNewQuestion()">
                                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„
                            </button>
                            <button class="btn btn-outline" onclick="previewQuestions()">
                                <i class="fas fa-eye"></i> Ù…Ø¹Ø§ÙŠÙ†Ø©
                            </button>
                        </div>
                        <div class="questions-list" id="questions-list">
                            ${renderQuestionsList()}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
        function getCategoriesCount() {
            const categories = new Set(appState.questions.map(q => q.category));
            return categories.size;
        }

        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        function renderQuestionsList() {
            if (appState.questions.length === 0) {
                return '<p class="no-questions">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
            }
            
            return appState.questions.map((q, index) => `
                <div class="question-item">
                    <div class="question-header">
                        <span class="question-number">${index + 1}</span>
                        <span class="question-category">${q.category}</span>
                        <button class="btn btn-sm btn-danger" onclick="deleteQuestion(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="question-text">${q.question}</div>
                    <div class="question-options">
                        ${q.options.map((opt, i) => `
                            <span class="option ${i === q.answer ? 'correct' : ''}">
                                ${opt} ${i === q.answer ? 'âœ“' : ''}
                            </span>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ù…Ù„Ù ÙŠØ®ØªØ§Ø±Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (txt/json)
        function importQuestionsFromUserFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt,.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const content = e.target.result;
                            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù„ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                            showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            openQuestionsManager(); // Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        } catch (error) {
                            showNotification('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Ø­Ø°Ù Ø³Ø¤Ø§Ù„
        function deleteQuestion(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')) {
                appState.questions.splice(index, 1);
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.getElementById('questions-list').innerHTML = renderQuestionsList();
            }
        }

        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        function previewQuestions() {
            alert(`ÙŠÙˆØ¬Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹ ${appState.questions.length} Ø³Ø¤Ø§Ù„ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ø¨Ø©\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø£Ùˆ Ø§Ø³ØªÙŠØ±Ø§Ø¯Ù‡Ø§ Ù…Ù† Ù…Ù„Ù.`);
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        function startGame() {
            if (appState.connectedTeams.length < 2) {
                alert('ÙŠØ¬Ø¨ Ø§Ù†Ø¶Ù…Ø§Ù… ÙØ±ÙŠÙ‚ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©');
                return;
            }
            
            if (!appState.questions || appState.questions.length === 0) {
                if (appState.selectedGroup && Array.isArray(appState.selectedGroup.questions) && appState.selectedGroup.questions.length > 0) {
                    appState.questions = appState.selectedGroup.questions;
                } else if (appState.questionGroups && appState.questionGroups.length > 0 && appState.questionGroups[0].questions && appState.questionGroups[0].questions.length > 0) {
                    appState.questions = appState.questionGroups[0].questions;
                    appState.selectedGroup = appState.questionGroups[0];
                } else if (appState.allQuestions && appState.allQuestions.length > 0) {
                    appState.questions = appState.allQuestions;
                }
            }
            if (!appState.questions || appState.questions.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¬Ø§Ù‡Ø²Ø©. Ø§ÙØªØ­ "Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©" ÙˆØ§Ø®ØªØ± Ù…Ø¬Ù…ÙˆØ¹Ø©ØŒ Ø£Ùˆ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.');
                return;
            }
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            localStorage.setItem('gameStarted', 'false'); // Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ù… ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯
            localStorage.setItem('gameInProgress', 'false'); // Ù„Ø§ ØªØ¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¹Ø¯
            localStorage.setItem('roomActive', 'false'); // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØºØ±ÙØ© Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø³Ø¦Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸
            console.log('Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ appState:', appState.questions);
            console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:', appState.questions ? appState.questions.length : 0);
            
            if (appState.questions && appState.questions.length > 0) {
                localStorage.setItem('currentQuestions', JSON.stringify(appState.questions));
                localStorage.setItem('gameQuestions', JSON.stringify(appState.questions)); // Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                localStorage.setItem('selectedQuestions', JSON.stringify(appState.questions)); // Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                console.log('ØªÙ… Ø­ÙØ¸', appState.questions.length, 'Ø³Ø¤Ø§Ù„ ÙÙŠ currentQuestions');
            } else {
                console.error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„Ù„Ø­ÙØ¸! Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©...');
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
                if (appState.selectedGroup && appState.questionGroups) {
                    const selectedGroupData = appState.questionGroups.find(g => g.id === appState.selectedGroup.id);
                    if (selectedGroupData && selectedGroupData.questions) {
                        console.log('ÙˆØ¬Ø¯Øª Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:', selectedGroupData.questions.length);
                        appState.questions = selectedGroupData.questions;
                        
                        localStorage.setItem('currentQuestions', JSON.stringify(appState.questions));
                        localStorage.setItem('gameQuestions', JSON.stringify(appState.questions));
                        localStorage.setItem('selectedQuestions', JSON.stringify(appState.questions));
                        console.log('ØªÙ… Ø­ÙØ¸', appState.questions.length, 'Ø³Ø¤Ø§Ù„ Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©');
                    } else {
                        console.error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©!');
                        showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…Ø­Ø¯Ø¯Ø©! Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ø³Ø¦Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
                        return;
                    }
                } else {
                    console.error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø®ØªØ§Ø±Ø© Ø£Ùˆ Ø£Ø³Ø¦Ù„Ø©!');
                    showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ø³Ø¦Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    return;
                }
            }
            
            localStorage.setItem('gameTeams', JSON.stringify(appState.connectedTeams));
            localStorage.setItem('currentRoom', appState.roomCode);
            
            // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            localStorage.removeItem('gameStarted');
            localStorage.removeItem('gameInProgress');
            localStorage.removeItem('currentQuestionIndex');
            localStorage.removeItem('questionStartTime');
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebase Ø­ØªÙ‰ ÙŠØ±Ù‰ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø£Ø®Ø±Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø©
            if (typeof FirebaseSync !== 'undefined' && FirebaseSync.isEnabled() && appState.roomCode) {
                FirebaseSync.setGameStateOnServer(appState.roomCode, {
                    roomActive: false,
                    currentQuestions: appState.questions,
                    gameTeams: appState.connectedTeams
                }).then(function() { console.log('[Firebase] ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©'); });
            }
            
            console.log('ØªÙ… Ù…Ø³Ø­ Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©');
            console.log('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© - ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±');
            
            // Ù„Ø§ ØªØ±Ø³Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„ Ù‡Ù†Ø§ - Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…Ø¹Ù„Ù… ÙŠØ¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©"
            console.log('Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¬Ø§Ù‡Ø²Ø© - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¶ØºØ· Ø§Ù„Ù…Ø¹Ù„Ù… Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©"');
            
            // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ù‚
            distributeCards();
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø¹Ù„Ù…
            console.log('Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©...');
            window.location.href = 'teacher-monitor.html?autoStart=false';
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
        function resetGame() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ')) {
                appState.gameInProgress = false;
                appState.connectedTeams = [];
                localStorage.removeItem('connectedTeams');
                localStorage.removeItem('gameInProgress');
                localStorage.setItem('roomActive', 'true'); // Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„ØºØ±ÙØ©
                
                // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø±Ø¯
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('kickedTeam_')) {
                        localStorage.removeItem(key);
                    }
                }
                
                updateTeamsStatus();
                showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©', 'success');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€” ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø§Ù„ÙŠØ§Ù‹
        async function loadQuestionsFromTextAsset() {
            try {
                console.log('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ù…Ù„Ù Ø§Ù„Ø§Ø³Ø§Ù„Ù‡...');
                
                // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù
                const response = await fetch('Ø§Ù„Ø§Ø³Ø§Ù„Ù‡');
                const text = await response.text();
                
                // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù (ÙŠØ¯Ø¹Ù… (ØµØ­))
                const questions = parseQuestionsFromText(text);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµÙÙˆÙØ©
                appState.allQuestions = questions;
                
                console.log(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${questions.length} Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­`);
                return questions;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:', error);
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© ÙƒØ®Ø·Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                return appState.allQuestions;
            }
        }

        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø§Ù„Ù†Øµ
        function parseQuestionsFromTextLegacy(text) {
            const questions = [];
            const lines = text.split('\n').filter(line => line.trim());
            
            let currentQuestion = {};
            let questionNumber = 1;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³Ø¤Ø§Ù„
                if (line.match(/^\d+\./)) {
                    // Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ø°Ø§ ÙˆØ¬Ø¯
                    if (currentQuestion.question && currentQuestion.options.length >= 4) {
                        questions.push(currentQuestion);
                    }
                    
                    // Ø¨Ø¯Ø¡ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
                    currentQuestion = {
                        question: line.replace(/^\d+\.\s*/, ''),
                        options: [],
                        answer: -1,
                        category: "Ø¹Ù„ÙˆÙ…"
                    };
                } 
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                else if (line.match(/^[Ø£Ø¨Ø¬Ø¯]\)/)) {
                    const option = line.replace(/^[Ø£Ø¨Ø¬Ø¯]\)\s*/, '');
                    currentQuestion.options.push(option);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØªØ­ØªÙ„ Ø¹Ù„Ø§Ù…Ø© âœ“ Ø£Ùˆ ØµØ­)
                    if (line.includes('(âœ“)') || line.includes('âœ“') || line.includes('(ØµØ­)')) {
                        currentQuestion.answer = currentQuestion.options.length - 1;
                    }
                }
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ø®ÙŠØ±
            if (currentQuestion.question && currentQuestion.options.length >= 4) {
                questions.push(currentQuestion);
            }
            
            return questions;
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        async function init() {
            console.log('Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…...');
            await prepareQuestionsData();

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            if (appState.allQuestions && appState.allQuestions.length > 0) {
                initializeQuestions();
            }

            await createRoom();
            setupEventListeners();
            startTeamUpdates();

            console.log('ØªÙ… ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… Ø¨Ù†Ø¬Ø§Ø­');
        }

    document.addEventListener('DOMContentLoaded', function() {
        setupTeacherCodeCheck(function() {
            init();
        });

        if (isTeacherVerified()) {
            hideTeacherCodeOverlay();
            init();
        } else {
            showTeacherCodeOverlay();
            var input = document.getElementById('teacher-code-input');
            if (input) input.focus();
        }
    });

    // ==================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ====================
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø­Ø³Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
    function calculatePoints(answerTime, isCorrect) {
        if (!appState.gameSettings.advancedScoring) {
            return isCorrect ? 1 : 0;
        }
        
        if (answerTime <= 10) {
            return isCorrect ? 3 : -3;
        } else if (answerTime <= 20) {
            return isCorrect ? 2 : -2;
        } else if (answerTime <= appState.gameSettings.questionTime) {
            return isCorrect ? 1 : -1;
        } else {
            return -2; // Ø¹Ø¯Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        }
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù†Ùƒ
    function updateBank(teamId, amount) {
        const team = appState.connectedTeams.find(t => t.id === teamId);
        if (team) {
            team.bank = (team.bank || 0) + amount;
            updateTeamUI(team);
        }
    }

    // Ø§Ù„ØªØ³Ø§ÙˆÙŠ
    function checkBalance(teamId) {
        const team = appState.connectedTeams.find(t => t.id === teamId);
        if (team && team.score < 0) {
            updateBank(teamId, Math.abs(team.score));
            team.score = 0;
            updateTeamUI(team);
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
    function handleMultipleAnswers(questionData) {
        const correctAnswers = Object.entries(questionData)
            .filter(([team, data]) => data.answer === questionData.correctAnswer)
            .map(([team, data]) => ({ team, time: data.time }));
        
        if (correctAnswers.length > 1) {
            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø©
            correctAnswers.sort((a, b) => a.time - b.time);
            
            // Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø±Ø¹ ÙŠØ³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø£Ø¨Ø·Ø£
            for (let i = 1; i < correctAnswers.length; i++) {
                const fasterTeam = correctAnswers[0].team;
                const slowerTeam = correctAnswers[i].team;
                
                const fasterTeamData = appState.connectedTeams.find(t => t.id === fasterTeam);
                const slowerTeamData = appState.connectedTeams.find(t => t.id === slowerTeam);
                
                if (slowerTeamData && !slowerTeamData.shieldActive) {
                    const points = calculatePoints(slowerTeam.time, false);
                    slowerTeamData.score += points;
                    updateBank(fasterTeam, Math.abs(points));
                    updateTeamUI(slowerTeamData);
                    updateTeamUI(fasterTeamData);
                }
            }
        }
    }

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    function useCard(teamId, cardId) {
        const team = appState.connectedTeams.find(t => t.id === teamId);
        const card = appState.availableCards.find(c => c.id === cardId);
        
        if (!team || !card) {
            showNotification('ÙØ±ÙŠÙ‚ Ø£Ùˆ Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', 'error');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        if (!team.cards || !team.cards.includes(cardId)) {
            showNotification('Ù„Ø§ ØªÙ…Ù„Ùƒ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', 'error');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒØ§ÙÙŠØ©
        if (team.score < card.cost) {
            showNotification('Ù†Ù‚Ø§Ø· ØºÙŠØ± ÙƒØ§ÙÙŠØ©', 'error');
            return;
        }
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        switch (cardId) {
            case 'shield':
                team.shieldActive = true;
                showNotification(`ÙØ±ÙŠÙ‚ ${team.teamName} Ù†Ø´Ø· Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø±ØµÙŠØ¯`, 'success');
                break;
            case 'eliminate':
                // Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
                localStorage.setItem(`card_${cardId}_${teamId}`, 'active');
                showNotification(`ÙØ±ÙŠÙ‚ ${team.teamName} Ù†Ø´Ø· Ø­Ø°Ù Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª`, 'success');
                break;
            case 'freeze':
                // Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
                const targetTeam = prompt('Ø§Ø®ØªØ±Ù Ø§Ù„ÙØ±ÙŠÙ‚ Ù„ØªØ¬Ù…ÙŠØ¯Ù‡:');
                if (targetTeam) {
                    localStorage.setItem(`freeze_${targetTeam}`, 'active');
                    showNotification(`ÙØ±ÙŠÙ‚ ${targetTeam} Ù…Ø¬Ù…Ø¯`, 'success');
                }
                break;
        }
        
        // Ø®ØµÙ… Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        team.score -= card.cost;
        team.cards = team.cards.filter(c => c !== cardId);
        updateTeamUI(team);
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙØ±ÙŠÙ‚
    function updateTeamUI(team) {
        const teamElement = document.getElementById(`team-${team.id}`);
        if (teamElement) {
            const scoreElement = teamElement.querySelector('.team-score');
            const bankElement = teamElement.querySelector('.team-bank');
            const cardsElement = teamElement.querySelector('.team-cards');
            
            if (scoreElement) scoreElement.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${team.score}`;
            if (bankElement) bankElement.textContent = `Ø§Ù„Ø¨Ù†Ùƒ: ${team.bank || 0}`;
            if (cardsElement) cardsElement.textContent = `Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: ${team.cards ? team.cards.length : 0}`;
        }
    }

    // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ù‚
    function distributeCards() {
        appState.connectedTeams.forEach(team => {
            team.cards = ['shield', 'eliminate']; // Ø¨Ø·Ø§Ù‚ØªØ§Ù† Ù„ÙƒÙ„ ÙØ±ÙŠÙ‚
            team.bank = 5; // 5 Ù†Ù‚Ø§Ø· Ø¨Ø¯Ø§ÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ
            team.score = 0;
            team.shieldActive = false;
            updateTeamUI(team);
        });
    }

    // ==================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ====================
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø­Ø³Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
    function calculatePoints(answerTime, isCorrect) {
        if (!appState.gameSettings.advancedScoring) {
            return isCorrect ? 1 : 0;
        }
        
        if (answerTime <= 10) {
            return isCorrect ? 3 : -3;
        } else if (answerTime <= 20) {
            return isCorrect ? 2 : -2;
        } else if (answerTime <= appState.gameSettings.questionTime) {
            return isCorrect ? 1 : -1;
        } else {
            return -2; // Ø¹Ø¯Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        }
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù†Ùƒ
    function updateBank(teamId, amount) {
        const team = appState.connectedTeams.find(t => t.id === teamId);
        if (team) {
            team.bank = (team.bank || 0) + amount;
            updateTeamUI(team);
        }
    }

    // Ø§Ù„ØªØ³Ø§ÙˆÙŠ
    function checkBalance(teamId) {
        const team = appState.connectedTeams.find(t => t.id === teamId);
        if (team && team.score < 0) {
            updateBank(teamId, Math.abs(team.score));
            team.score = 0;
            updateTeamUI(team);
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
    function handleMultipleAnswers(questionData) {
        const correctAnswers = Object.entries(questionData)
            .filter(([team, data]) => data.answer === questionData.correctAnswer)
            .map(([team, data]) => ({ team, time: data.time }));
        
        if (correctAnswers.length > 1) {
            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø©
            correctAnswers.sort((a, b) => a.time - b.time);
            
            // Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø±Ø¹ ÙŠØ³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø£Ø¨Ø·Ø£
            for (let i = 1; i < correctAnswers.length; i++) {
                const fasterTeam = correctAnswers[0].team;
                const slowerTeam = correctAnswers[i].team;
                
                const fasterTeamData = appState.connectedTeams.find(t => t.id === fasterTeam);
                const slowerTeamData = appState.connectedTeams.find(t => t.id === slowerTeam);
                
                if (slowerTeamData && !slowerTeamData.shieldActive) {
                    const points = calculatePoints(slowerTeam.time, false);
                    slowerTeamData.score += points;
                    updateBank(fasterTeam, Math.abs(points));
                    updateTeamUI(slowerTeamData);
                    updateTeamUI(fasterTeamData);
                }
            }
        }
    }

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    function useCard(teamId, cardId) {
        const team = appState.connectedTeams.find(t => t.id === teamId);
        const card = appState.availableCards.find(c => c.id === cardId);
        
        if (!team || !card) {
            showNotification('ÙØ±ÙŠÙ‚ Ø£Ùˆ Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', 'error');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        if (!team.cards || !team.cards.includes(cardId)) {
            showNotification('Ù„Ø§ ØªÙ…Ù„Ùƒ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', 'error');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒØ§ÙÙŠØ©
        if (team.score < card.cost) {
            showNotification('Ù†Ù‚Ø§Ø· ØºÙŠØ± ÙƒØ§ÙÙŠØ©', 'error');
            return;
        }
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        switch (cardId) {
            case 'shield':
                team.shieldActive = true;
                showNotification(`ÙØ±ÙŠÙ‚ ${team.teamName} Ù†Ø´Ø· Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø±ØµÙŠØ¯`, 'success');
                break;
            case 'eliminate':
                // Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
                localStorage.setItem(`card_${cardId}_${teamId}`, 'active');
                showNotification(`ÙØ±ÙŠÙ‚ ${team.teamName} Ù†Ø´Ø· Ø­Ø°Ù Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª`, 'success');
                break;
            case 'freeze':
                // Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
                const targetTeam = prompt('Ø§Ø®ØªØ±Ù Ø§Ù„ÙØ±ÙŠÙ‚ Ù„ØªØ¬Ù…ÙŠØ¯Ù‡:');
                if (targetTeam) {
                    localStorage.setItem(`freeze_${targetTeam}`, 'active');
                    showNotification(`ÙØ±ÙŠÙ‚ ${targetTeam} Ù…Ø¬Ù…Ø¯`, 'success');
                }
                break;
        }
        
        // Ø®ØµÙ… Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        team.score -= card.cost;
        team.cards = team.cards.filter(c => c !== cardId);
        updateTeamUI(team);
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙØ±ÙŠÙ‚
    function updateTeamUI(team) {
        const teamElement = document.getElementById(`team-${team.id}`);
        if (teamElement) {
            const scoreElement = teamElement.querySelector('.team-score');
            const bankElement = teamElement.querySelector('.team-bank');
            const cardsElement = teamElement.querySelector('.team-cards');
            
            if (scoreElement) scoreElement.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${team.score}`;
            if (bankElement) bankElement.textContent = `Ø§Ù„Ø¨Ù†Ùƒ: ${team.bank || 0}`;
            if (cardsElement) cardsElement.textContent = `Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: ${team.cards ? team.cards.length : 0}`;
        }
    }

    // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ù‚
    function distributeCards() {
        appState.connectedTeams.forEach(team => {
            team.cards = ['shield', 'eliminate']; // Ø¨Ø·Ø§Ù‚ØªØ§Ù† Ù„ÙƒÙ„ ÙØ±ÙŠÙ‚
            team.bank = 5; // 5 Ù†Ù‚Ø§Ø· Ø¨Ø¯Ø§ÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ
            team.score = 0;
            team.shieldActive = false;
            updateTeamUI(team);
        });
    }

    // ==================== Ù†Ù‡Ø§ÙŠØ© ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ====================

    </script>
</body>
</html>

